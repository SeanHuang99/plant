<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Requests</title>
    <script src="/javascript/commonTool.js"></script>
    <script src="/import/jquery-3.7.1.min.js"></script>
    <link href="/import/bootstrap.min.css" rel="stylesheet">
    <script src="/import/bootstrap.min.js"></script>
    <script src="/javascript/idb-utility.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Update Requests</h1>
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="text-center" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading</span>
            </div>
        </div>
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>Plant ID</th>
                <th>Plant Name</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
            </thead>
            <tbody>
            <!-- Rows will be added by jQuery -->
            </tbody>
        </table>
    </div>

<script>
    $(document).ready(function() {
        $('#loadingIndicator').show(); // Show loading indicator when the AJAX call starts
        let nickName = getNickName();
        // Assuming getNickName returns a promise and is available on the commonTools object or globally

            console.log("Using nickname for AJAX call:", nickName);

            // Proceed with the AJAX request
            $.ajax({
                url: `/api/getAllUpdateRequests?nickName=${encodeURIComponent(nickName)}`,
                type: 'GET',
                success: function(response) {
                    console.log("AJAX call was successful, data received:", response);
                    $('#loadingIndicator').hide(); // Hide the loading indicator on success

                    if (response.type === 'success' && response.content.length > 0) {
                        let requests = response.content;
                        let tbody = $('table tbody');
                        tbody.empty();
                        console.log(requests);
                        requests.forEach(request => {
                            tbody.append(
                                `<tr>
                                <td>${request.plantId || 'N/A'}</td>
                                <td>${request.plantName || 'N/A'}</td>
                                <td>${request.statusOfRequest || 'in-progress'}</td>
                                <td>${request.date ? new Date(request.date).toLocaleDateString() : 'Unknown'}</td>
                            </tr>`
                            );
                        });
                    } else {
                        $('table tbody').html('<tr><td colspan="4">No data found.</td></tr>');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error during AJAX call:', status, error, 'Response:', xhr.responseText);
                    $('#loadingIndicator').hide(); // Hide the loading indicator on error
                    $('table tbody').html('<tr><td colspan="4">Failed to load data.</td></tr>');
                }
            });
        }).catch(error => {
            console.error('Error fetching nickname:', error);
            $('#loadingIndicator').hide(); // Hide the loading indicator if there's an error fetching nickname
        });








</script>
</body>
</html>